<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GB Service - Reboque</title>
    <link rel="shortcut icon" type="imagex/png" href="fav.ico">
    <style>
            /* Reset b√°sico */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Fundo com gradiente sutil para efeito moderno */
            background: linear-gradient(135deg, #e0f2ff 0%, #f7f9fc 100%); 
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .container {
            background: white;
            max-width: 600px;
            width: 100%;
            padding: 30px 40px;
            /* Aumenta o arredondamento */
            border-radius: 20px; 
            /* Sombra mais suave e moderna */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08), 0 4px 10px rgba(0, 0, 0, 0.05);
            margin-top: 40px; /* Adiciona um espa√ßo superior */
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            font-size: 1.4rem; /* Um pouco maior */
            margin-bottom: 20px;
            color: #1a73e8; /* Cor mais proeminente */
            border-bottom: none; /* Remove a borda inferior */
            padding-bottom: 0;
            display: flex;
            align-items: center;
        }
        
        .section h2::before {
            content: 'üìç'; /* √çcone de localiza√ß√£o */
            display: inline-block;
            margin-right: 10px;
            font-size: 1.5rem;
            color: #1a73e8;
        }

        /* Formul√°rio */
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 18px; /* Mais espa√ßo */
        }

        label {
            margin-bottom: 8px; /* Mais espa√ßo */
            font-weight: 600;
            color: #444; /* Cor mais escura para melhor legibilidade */
            user-select: none;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 12px 15px;
            border: 1px solid #e0e0e0; /* Borda mais fina e clara */
            border-radius: 10px; /* Mais arredondado */
            font-size: 1rem;
            transition: all 0.3s ease;
            outline-offset: 0;
            background-color: #f9f9f9;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: #1a73e8;
            outline: none;
            box-shadow: 0 0 8px rgba(26, 115, 232, 0.2); /* Sombra de foco mais suave */
            background-color: white;
        }

        /* Bot√£o Padr√£o (Calcular Valor) */
        button {
            cursor: pointer;
            background: #1a73e8;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 25px;
            font-size: 1.1rem;
            border-radius: 10px;
            font-weight: 700;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.1s ease; /* Adiciona transform */
            user-select: none;
            margin-top: 5px;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3); /* Sombra para o bot√£o */
        }

        button:hover {
            background: #155ab6;
            transform: translateY(-1px); /* Efeito sutil de levantar */
        }
        
        button:active {
            transform: translateY(1px); /* Efeito de pressionar */
            box-shadow: none;
        }
        
        /* Estiliza√ß√£o do Toggle de Escolha (Aba/Bot√£o) */
        .input-toggle {
            margin-bottom: 25px;
        }

        .input-toggle > label {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #333;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            gap: 10px; /* Espa√ßo entre os bot√µes */
            flex-wrap: wrap;
            border: none; /* Remove a borda externa */
            border-radius: 12px;
            overflow: visible; /* Garante que as sombras n√£o sejam cortadas */
            background-color: transparent; /* Remove fundo cinza */
        }

        .radio-group input[type="radio"] {
            display: none;
        }

        .radio-group label {
            flex-grow: 1;
            /* --- AJUSTE PARA CENTRALIZA√á√ÉO VERTICAL E HORIZONTAL --- */
            display: flex;
            align-items: center;
            justify-content: center;
            /* ----------------------------------------------------- */
            padding: 15px 20px; /* Aumenta o padding */
            cursor: pointer;
            background-color: white; /* Fundo branco padr√£o */
            transition: all 0.3s ease;
            font-weight: 600;
            color: #555;
            margin-bottom: 0;
            border: 1px solid #ddd; /* Borda sutil */
            border-radius: 10px; /* Arredondamento individual */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            /* Remove a borda direita desnecess√°ria */
            border-right: 1px solid #ddd;
        }

        .radio-group label:last-child {
             border-right: 1px solid #ddd; /* Mant√©m a borda no √∫ltimo item */
        }

        .radio-group label:hover {
            background-color: #f0f4f8; /* Efeito hover sutil */
        }
        
        .radio-group input[type="radio"]:checked + label {
            background-color: #1a73e8;
            color: white;
            border-color: #1a73e8;
            /* Sombra mais proeminente e sem o efeito inset */
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.4); 
            transform: translateY(-2px); /* Efeito de eleva√ß√£o ao selecionar */
        }
        /* Fim Estiliza√ß√£o Toggle */

        /* Estilos do Mapa */
        #map-canvas {
            height: 300px; 
            width: 100%;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            background-color: #e9e9e9;
        }
        
        .map-controls {
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .map-status {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: #d9480f; 
        }
        
        #resultado {
            font-weight: 700;
            white-space: pre-line;
            font-size: 1.1rem;
            padding: 20px 25px; /* Mais padding */
            background: #e1f0ff;
            border-radius: 10px; /* Mais arredondado */
            border: 1px solid #7ab8ff;
            min-height: 60px;
            color: #0d47a1;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        #mensagem-erro {
            color: #721c24; 
            margin-bottom: 20px; 
            padding: 15px; 
            border: 1px solid #f5c6cb; 
            background-color: #f8d7da;
            border-radius: 10px;
            font-weight: 600;
        }

        .whatsapp-button {
            background-color: #25D366; 
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-button:hover,
        .whatsapp-button:focus {
            background-color: #128C7E;
        }
        
        /* Estilo do bot√£o de confirma√ß√£o do mapa */
        #btn-confirmar-mapa {
            background-color: #38a169;
            box-shadow: 0 4px 10px rgba(56, 161, 105, 0.3);
        }
        #btn-confirmar-mapa:hover {
            background-color: #277e53;
        }

        #detalhes-moto {
            margin-top: 15px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background-color: #f0f4f8;
        }
        
        /* NOVO ESTILO PARA A LOGO (IMAGEM) */
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-img {
            max-width: 250px; 
            height: auto;
            border-radius: 6px; 
            display: inline-block;
        }
        /* FIM NOVO ESTILO LOGO */

        /* AJUSTE PARA O RODAP√â DISCRETO E CENTRALIZADO */
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.85rem;
            color: #999;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .footer strong {
            font-weight: 500; 
            color: #777;
        }
        /* FIM AJUSTE RODAP√â */
        
        /* Responsividade */
        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            .radio-group {
                gap: 5px; /* Reduz o espa√ßo no mobile */
            }
            .radio-group label {
                flex-basis: 48%; /* Garante 2 por linha */
                padding: 12px 10px;
                font-size: 0.9rem;
            }

            input[type="text"],
            input[type="number"],
            select,
            button {
                font-size: 1rem;
                padding: 12px 12px;
            }
            .section h2 {
                 font-size: 1.2rem;
            }
        }
    </style>
    <script>
        // =================================================================
        // ATEN√á√ÉO: CHAVE DE API DO GOOGLE MAPS
        // =================================================================
        // Se voc√™ pretende usar este c√≥digo fora do Canvas, substitua a chave abaixo.
        const API_KEY_GOOGLE = "AIzaSyBwd9QQquprtp9WM-M3KlzXe6rOKAy41Ns";
        
        // Coordenadas da Base (R. Dom Jo√£o VI, 6 - Santa Cruz, RJ)
        const BASE_ADDRESS = { lat: -22.923831, lng: -43.682701 };
        const WHATSAPP_NUMBER = "552141014470"; 
        
        // Vari√°veis globais para os servi√ßos do Google Maps
        let geocoder;
        let directionsService;
        let map;
        let originMarker, destinationMarker;
        let isGoogleMapsReady = false;
        let currentMapMode = null; // 'ORIGIN' ou 'DESTINATION'
        const RIO_CENTER = { lat: -22.9068, lng: -43.1729 }; // Centro do Rio de Janeiro
        
        // Fun√ß√£o de callback chamada quando o script do Google Maps √© carregado
        function initMap() {
            geocoder = new google.maps.Geocoder();
            directionsService = new google.maps.DirectionsService();
            isGoogleMapsReady = true;
            console.log("Servi√ßos do Google Maps inicializados.");
            
            // Inicializa√ß√£o do mapa (oculto inicialmente)
            const mapCanvas = document.getElementById('map-canvas');
            if(mapCanvas) {
                map = new google.maps.Map(mapCanvas, {
                    center: RIO_CENTER,
                    zoom: 10,
                    fullscreenControl: false,
                    streetViewControl: false,
                    gestureHandling: 'greedy' 
                });

                // Marcador de Origem (Vermelho)
                originMarker = new google.maps.Marker({
                    map: map,
                    position: BASE_ADDRESS, 
                    icon: { 
                        url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png" 
                    }
                });
                
                // Marcador de Destino (Azul)
                destinationMarker = new google.maps.Marker({
                    map: map,
                    position: RIO_CENTER, 
                    icon: { 
                        url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png" 
                    }
                });

                originMarker.setVisible(false);
                destinationMarker.setVisible(false);

                // Listener de clique no mapa
                map.addListener('click', handleMapClick);
            }
            
            // --- IMPLEMENTA√á√ÉO DO AUTOCOMPLETE ---
            
            // 1. Autocomplete Origem
            const inputOrigemAuto = document.getElementById('input-endereco-origem');
            // Restringe a busca a endere√ßos
            const autocompleteOrigem = new google.maps.places.Autocomplete(inputOrigemAuto, {
                componentRestrictions: { country: "br" }, 
                fields: ["geometry", "formatted_address", "address_components"], 
                types: ["address"] 
            });
            autocompleteOrigem.addListener('place_changed', () => handleAutocompletePlaceChanged(autocompleteOrigem, 'ORIGIN'));

            // 2. Autocomplete Destino
            const inputDestinoAuto = document.getElementById('input-endereco-destino');
            const autocompleteDestino = new google.maps.places.Autocomplete(inputDestinoAuto, {
                componentRestrictions: { country: "br" },
                fields: ["geometry", "formatted_address", "address_components"],
                types: ["address"] 
            });
            autocompleteDestino.addListener('place_changed', () => handleAutocompletePlaceChanged(autocompleteDestino, 'DESTINATION'));
            
            toggleOriginInput('auto'); 
            toggleDestinationInput('auto');
        }
        
        // === NOVA FUN√á√ÉO DE LIMPEZA DE STATUS (REMOVE CONFIRMADO, MAPA E LOCALIZA√á√ÉO ATUAL) ===
        function limparStatusConfirmado(endereco) {
            if (!endereco) return "";
            // Remove (CONFIRMADO), (Mapa), (LOCALIZA√á√ÉO ATUAL) e espa√ßos adjacentes
            return endereco.replace(/\s*\((CONFIRMADO|Mapa|LOCALIZA√á√ÉO ATUAL)\)\s*/g, "").trim();
        }
        // =========================================================================================

        // --- FUN√á√ïES DE LIMPEZA E AVISO ---

        function mostrarMensagemErro(msg) {
            const div = document.getElementById("mensagem-erro");
            div.style.display = "block";
            div.innerHTML = `<strong>${msg}</strong>`;
        }

        function limparMensagemErro() {
            const div = document.getElementById("mensagem-erro");
            div.style.display = "none";
            div.textContent = "";
        }
        
        // --- FUN√á√ÉO PARA RESETAR O FORMUL√ÅRIO ---
        function resetForm() {
            // 1. Reset input fields
            document.getElementById("origem").value = "";
            document.getElementById("destino").value = "";
            
            // Autocomplete Origem
            document.getElementById("numero-origem-auto").value = "";
            document.getElementById("input-endereco-origem").value = ""; 
            document.getElementById("base-address-origem").value = ""; 
            
            // Autocomplete Destino
            document.getElementById("numero-destino-auto").value = "";
            document.getElementById("input-endereco-destino").value = ""; 
            document.getElementById("base-address-destino").value = ""; 

            document.getElementById("marca-moto").value = "";
            document.getElementById("modelo-moto").value = "";
            document.getElementById("cilindrada-moto").value = "";
            document.getElementById("tipo").selectedIndex = 0; // Reset vehicle type
            
            // 2. Reset hidden coordinates
            document.getElementById("coord-origem-lon").value = "";
            document.getElementById("coord-origem-lat").value = "";
            document.getElementById("coord-destino-lon").value = "";
            document.getElementById("coord-destino-lat").value = "";

            // 3. Reset UI feedback
            document.getElementById("resultado").innerText = "Preencha todos os campos e clique em CALCULAR.";
            document.getElementById("origem").style.fontWeight = 'normal';
            document.getElementById("destino").style.fontWeight = 'normal';
            document.getElementById("detalhes-moto").style.display = "none";
            
            // 4. Hide status/action buttons
            document.getElementById("whatsapp-container").style.display = 'none';
            document.getElementById("nova-consulta-container").style.display = 'none';
            document.getElementById("whatsapp-solicitar-btn").setAttribute('disabled', 'true');
            
            // 5. Hide error messages
            limparMensagemErro();

            // 6. Reset map modes and visibility
            document.getElementById("map-interaction-section").style.display = 'none';
            currentMapMode = null;
            if (originMarker) originMarker.setVisible(false);
            if (destinationMarker) destinationMarker.setVisible(false);
            
            // 7. Reset radio selections to default (auto) and apply toggle
            document.getElementById("choice-origem-auto").checked = true;
            document.getElementById("choice-dest-auto").checked = true;
            toggleOriginInput('auto'); 
            toggleDestinationInput('auto'); 
            
            // 8. Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        // --- FUN√á√ïES DE UTILIDADE ---
        
        function updateWhatsappButton(origem, destino, valor) {
            const btn = document.getElementById("whatsapp-solicitar-btn");
            // 1. Torna o container do WhatsApp vis√≠vel
            document.getElementById("whatsapp-container").style.display = 'block'; 
            
            // O endere√ßo j√° deve vir limpo da fun√ß√£o calcular
            const msg = encodeURIComponent(
                `Ol√°! Gostaria de solicitar um reboque.\n\n` +
                `üìç Origem: ${origem}\n` +
                `üèÅ Destino: ${destino}\n\n` +
                `üíµ Valor estimado: R$ ${valor.toFixed(2)}\n\n` +
                `Por favor, confirme a disponibilidade.`
            );
            btn.removeAttribute('disabled');
            btn.onclick = () => {
                window.open(`https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${msg}`, '_blank');
            };
        }
        
        // --- FUN√á√ïES DE BUSCA/GEOCODING (Google Maps) ---
        
        function geocodeAddress(address) {
            return new Promise((resolve, reject) => {
                geocoder.geocode({ 'address': address }, (results, status) => {
                    if (status === 'OK') {
                        // Retorna o objeto LatLng e o endere√ßo formatado
                        resolve({ 
                            location: results[0].geometry.location,
                            formatted_address: results[0].formatted_address
                        });
                    } else if (status === 'ZERO_RESULTS') {
                        reject(new Error(`Endere√ßo n√£o encontrado: "${address}"`));
                    } else {
                        reject(new Error(`Falha na busca do endere√ßo com status: ${status}.`));
                    }
                });
            });
        }
        
        function reverseGeocode(latlng) {
            return new Promise((resolve, reject) => {
                geocoder.geocode({ 'location': latlng }, (results, status) => {
                    if (status === 'OK' && results[0]) {
                        resolve(results[0].formatted_address);
                    } else if (status === 'ZERO_RESULTS') {
                        resolve(`Localiza√ß√£o desconhecida: (${latlng.lat()}, ${latlng.lng()})`);
                    } else {
                        reject(new Error(`Falha no Geocoding Reverso com status: ${status}`));
                    }
                });
            });
        }
        
        // --- FUN√á√ÉO PARA OBTER LOCALIZA√á√ÉO ATUAL (AGORA NO MAPA) ---
        async function getAndCenterCurrentLocation(mode) {
             const mapStatus = document.getElementById("map-status");
             const marker = mode === 'ORIGIN' ? originMarker : destinationMarker;
             const fallbackCenter = RIO_CENTER;
             
             mapStatus.textContent = "Aguarde... Buscando sua localiza√ß√£o GPS...";
             document.getElementById("btn-confirmar-mapa").disabled = true;

             if (!navigator.geolocation) {
                 mapStatus.textContent = `Geolocaliza√ß√£o n√£o suportada. Centralizado em RJ.`;
                 document.getElementById("btn-confirmar-mapa").disabled = false;
                 map.setCenter(fallbackCenter);
                 return fallbackCenter; 
             }
             
             try {
                 const position = await new Promise((resolve, reject) => {
                     navigator.geolocation.getCurrentPosition(resolve, reject, {
                         enableHighAccuracy: true,
                         timeout: 5000,
                         maximumAge: 0
                     });
                 });
                 
                 const latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                 
                 // Centraliza o mapa e move o marcador tempor√°rio para o GPS
                 map.setCenter(latlng);
                 map.setZoom(15);
                 marker.setPosition(latlng);
                 marker.setVisible(true);

                 // Executa o geocoding reverso para preencher o campo tempor√°rio
                 await handleMapClick({ latLng: latlng });

                 mapStatus.textContent = `Localiza√ß√£o GPS encontrada. Arraste ou clique para ajustar.`;
                 
                 return latlng;

             } catch (error) {
                 let msg = "Falha ao obter GPS. Arraste ou clique no mapa para definir o ponto.";
                 if (error.code === 1) {
                     msg = "Permiss√£o de geolocaliza√ß√£o negada. Arraste o mapa.";
                 }
                 mapStatus.textContent = msg;
                 map.setCenter(fallbackCenter);
                 map.setZoom(12);
                 document.getElementById("btn-confirmar-mapa").disabled = false;
                 
                 return fallbackCenter;
             } finally {
                 document.getElementById("btn-confirmar-mapa").disabled = false;
             }
         }
        
        // --- FIX: MELHORIA NA FUN√á√ÉO DE FORMATA√á√ÉO DE ENDERE√áO NO PADR√ÉO BR ---
        
        function formatAddressFromComponents(place, numero) {
            let components = {};

            // 1. Extrai componentes relevantes
            for (const component of place.address_components) {
                if (component.types.includes('route')) {
                    components.route = component.long_name;
                } else if (component.types.includes('sublocality_level_1')) {
                    // Bairro (Prioridade 1: sublocality_level_1)
                    components.sublocality = component.long_name;
                } else if (!components.sublocality && component.types.includes('sublocality')) {
                     // Bairro (Prioridade 2: sublocality gen√©rico, menos comum no Brasil)
                    components.sublocality = component.long_name;
                } else if (component.types.includes('administrative_area_level_2')) {
                    // Cidade/Munic√≠pio (administrative_area_level_2)
                    components.city = component.long_name;
                } else if (component.types.includes('administrative_area_level_1')) {
                    // Estado/UF
                    components.state = component.short_name; 
                } else if (component.types.includes('postal_code')) {
                    components.zip = component.long_name;
                }
            }
            
            // 2. Define Fallbacks caso n√£o encontre
            const logradouro = components.route || place.formatted_address.split(',')[0].trim(); 
            const bairro = components.sublocality || "Bairro N√£o Informado";
            const cidade = components.city || "Cidade N√£o Informada";
            const estado = components.state || "UF";
            const cep = components.zip || "CEP N√£o Informado";

            // 3. Formato Padr√£o Brasileiro (Rua, N√∫mero - Bairro, Cidade - UF, CEP)
            let enderecoFormatado = `${logradouro}, ${numero} - ${bairro}, ${cidade} - ${estado}, ${cep}`;
            
            return enderecoFormatado;
        }

        // --- FUN√á√ÉO PARA ATUALIZAR O CAMPO VIS√çVEL DE ORIGEM (USADO NO AUTOCOMPLETE) ---
        function updateOriginDisplayAddress() {
            const baseAddressComponents = document.getElementById('base-address-origem').value;
            const numero = document.getElementById('numero-origem-auto').value.trim();
            const origemField = document.getElementById('origem');

            // Verifica se est√° no modo Autocomplete e se o endere√ßo base foi selecionado
            if (document.querySelector('input[name="origin-choice"]:checked').value !== 'auto' || !baseAddressComponents) {
                return;
            }

            if (baseAddressComponents && numero) {
                try {
                    const place = JSON.parse(baseAddressComponents);
                    const formatted = formatAddressFromComponents(place, numero);

                    // Preenche o campo final com o endere√ßo limpo E o marca como confirmado
                    origemField.value = limparStatusConfirmado(formatted); 
                    origemField.style.fontWeight = 'bold';
                    limparMensagemErro(); 
                } catch (e) {
                    console.error("Erro ao processar JSON de endere√ßo base:", e);
                    origemField.value = "Erro ao formatar endere√ßo. Tente novamente.";
                    origemField.style.fontWeight = 'normal';
                }

            } else if (baseAddressComponents && !numero) {
                // Endere√ßo base selecionado, mas faltando o n√∫mero
                origemField.value = `Endere√ßo selecionado. Por favor, informe o n√∫mero.`;
                origemField.style.fontWeight = 'normal';
            } else {
                 // Caso o usu√°rio apague tudo
                 origemField.value = "";
                 origemField.placeholder = "Selecione a rua e depois informe o n√∫mero no campo acima.";
                 origemField.style.fontWeight = 'normal';
            }
        }
        
        // --- FUN√á√ÉO PARA ATUALIZAR O CAMPO VIS√çVEL DE DESTINO (USADO NO AUTOCOMPLETE) ---
        function updateDestinationDisplayAddress() {
            const baseAddressComponents = document.getElementById('base-address-destino').value;
            const numero = document.getElementById('numero-destino-auto').value.trim();
            const destinoField = document.getElementById('destino');

            // Verifica se est√° no modo Autocomplete e se o endere√ßo base foi selecionado
            if (document.querySelector('input[name="destination-choice"]:checked').value !== 'auto' || !baseAddressComponents) {
                return;
            }

            if (baseAddressComponents && numero) {
                try {
                    const place = JSON.parse(baseAddressComponents);
                    const formatted = formatAddressFromComponents(place, numero);

                    // Preenche o campo final com o endere√ßo limpo E o marca como confirmado
                    destinoField.value = limparStatusConfirmado(formatted); 
                    destinoField.style.fontWeight = 'bold';
                    limparMensagemErro(); 
                } catch (e) {
                    console.error("Erro ao processar JSON de endere√ßo base:", e);
                    destinoField.value = "Erro ao formatar endere√ßo. Tente novamente.";
                    destinoField.style.fontWeight = 'normal';
                }

            } else if (baseAddressComponents && !numero) {
                // Endere√ßo base selecionado, mas faltando o n√∫mero
                destinoField.value = `Endere√ßo selecionado. Por favor, informe o n√∫mero.`;
                destinoField.style.fontWeight = 'normal';
            } else {
                 // Caso o usu√°rio apague tudo
                 destinoField.value = "";
                 destinoField.placeholder = "Selecione a rua e depois informe o n√∫mero no campo acima.";
                 destinoField.style.fontWeight = 'normal';
            }
        }


        // --- FUN√á√ÉO DE AUTOCOMPLETE PLACE CHANGED (FIX UX) ---
        function handleAutocompletePlaceChanged(autocomplete, mode) {
            const place = autocomplete.getPlace();
            
            // CORRE√á√ÉO CR√çTICA: Verifica se o objeto place √© v√°lido e tem geometria
            if (!place || !place.geometry || !place.address_components) {
                mostrarMensagemErro(`‚ùå N√£o foi poss√≠vel encontrar a geometria ou componentes para o endere√ßo selecionado.`);
                return;
            }
            
            const lat = place.geometry.location.lat();
            const lon = place.geometry.location.lng();
            
            // Guarda as coordenadas definitivas (o c√°lculo usar√° estas)
            const coordLatField = mode === 'ORIGIN' ? document.getElementById('coord-origem-lat') : document.getElementById('coord-destino-lat');
            const coordLonField = mode === 'ORIGIN' ? document.getElementById('coord-origem-lon') : document.getElementById('coord-destino-lon');
            const baseAddressField = mode === 'ORIGIN' ? document.getElementById('base-address-origem') : document.getElementById('base-address-destino');
            
            coordLatField.value = lat;
            coordLonField.value = lon;
            
            // SALVA O OBJETO PLACE COMO JSON NO CAMPO HIDDEN
            baseAddressField.value = JSON.stringify(place);

            // Tenta manter apenas o nome da rua que foi selecionada
            const inputElement = autocomplete.get('input') || (mode === 'ORIGIN' ? document.getElementById('input-endereco-origem') : document.getElementById('input-endereco-destino'));
            if(inputElement) {
                inputElement.value = place.name || place.formatted_address.split(',')[0].trim();
            }

            // Chama a fun√ß√£o para atualizar o campo de exibi√ß√£o, que agora depende do n√∫mero
            if (mode === 'ORIGIN') {
                updateOriginDisplayAddress();
            } else {
                updateDestinationDisplayAddress();
            }

            // Limpa qualquer erro
            limparMensagemErro();
        }

        // --- FUN√á√ÉO PRINCIPAL DE ROTA (Google Maps) ---
        
        function getDistance(origin, destination) {
             return new Promise((resolve, reject) => {
                const request = {
                    origin: origin,       
                    destination: destination, 
                    travelMode: google.maps.TravelMode.DRIVING,
                    unitSystem: google.maps.UnitSystem.METRIC 
                };
                
                directionsService.route(request, (response, status) => {
                    if (status === 'OK') {
                        const route = response.routes[0];
                        // O Directions API retorna a dist√¢ncia em metros
                        const distanceMeters = route.legs[0].distance.value; 
                        resolve(distanceMeters / 1000); // Retorna em KM
                    } else if (status === 'ZERO_RESULTS' || status === 'NOT_FOUND') {
                        reject(new Error(`Rota n√£o encontrada (Status: ${status}).`));
                    } else {
                        reject(new Error(`Falha ao calcular rota: ${status}`));
                    }
                });
            });
        }

        // --- FUN√á√ÉO DE C√ÅLCULO GERAL ---

        async function calcular() {
            limparMensagemErro(); 
            
            // Oculta os bot√µes de a√ß√£o enquanto calcula
            document.getElementById("whatsapp-container").style.display = 'none';
            document.getElementById("nova-consulta-container").style.display = 'none';
            document.getElementById("whatsapp-solicitar-btn").setAttribute('disabled', 'true');
            
            if (!isGoogleMapsReady) {
                mostrarMensagemErro("‚ùå Os servi√ßos de mapa ainda n√£o est√£o prontos. Tente recarregar a p√°gina.");
                return;
            }

            document.getElementById("resultado").innerText = "Calculando...";
            
            let tipoVeiculo;
            let cilindrada = 0; 
            let coordOrigem, coordDestino;
            let origemAddress, destinoAddress;

            try {
                // 1. Obter e Validar Inputs
                tipoVeiculo = document.getElementById("tipo").value;
                if (!tipoVeiculo) throw new Error("Selecione o tipo de ve√≠culo.");

                origemAddress = document.getElementById("origem").value; 
                destinoAddress = document.getElementById("destino").value; 

                // FIX: Mudan√ßa na valida√ß√£o do endere√ßo
                // Endere√ßo s√≥ √© v√°lido se estiver em negrito (confirmado/completo)
                if (document.getElementById("origem").style.fontWeight !== 'bold') throw new Error("Defina e confirme o endere√ßo de Origem completo.");
                if (document.getElementById("destino").style.fontWeight !== 'bold') throw new Error("Defina e confirme o endere√ßo de Destino completo.");

                if (tipoVeiculo === "15") {
                    cilindrada = parseInt(document.getElementById("cilindrada-moto").value);
                    if (isNaN(cilindrada)) throw new Error("Informe a cilindrada da moto.");
                }
                
                // 2. Determinar Coordenadas de Origem 
                const savedLonOrigem = parseFloat(document.getElementById("coord-origem-lon").value);
                const savedLatOrigem = parseFloat(document.getElementById("coord-origem-lat").value);

                if (!isNaN(savedLonOrigem) && !isNaN(savedLatOrigem)) {
                    coordOrigem = new google.maps.LatLng(savedLatOrigem, savedLonOrigem);
                    // O endere√ßo j√° est√° limpo na UI, apenas aplicamos limpeza defensiva
                    origemAddress = limparStatusConfirmado(origemAddress);
                    
                } else {
                    throw new Error("As coordenadas de Origem n√£o foram definidas. Use um dos m√©todos acima.");
                }

                // 3. Determinar Coordenadas de Destino
                const savedDestLon = parseFloat(document.getElementById("coord-destino-lon").value);
                const savedDestLat = parseFloat(document.getElementById("coord-destino-lat").value);
                
                if (!isNaN(savedDestLon) && !isNaN(savedDestLat)) {
                    coordDestino = new google.maps.LatLng(savedDestLat, savedDestLon);
                    
                    // Aplicamos limpeza extra defensiva caso algum status tenha sido adicionado.
                    destinoAddress = limparStatusConfirmado(destinoAddress);
                    
                } else {
                     throw new Error("As coordenadas de Destino n√£o foram definidas. Use um dos m√©todos acima.");
                }
                
                // 4. Determinar Taxa Fixa
                let taxa = 0;
                if (tipoVeiculo === "50") taxa = 50;
                else if (tipoVeiculo === "15") {
                    if (cilindrada <= 160) taxa = 15;
                    else if (cilindrada <= 250) taxa = 25;
                    else if (cilindrada <= 499) taxa = 35;
                    else if (cilindrada <= 999) taxa = 50;
                    else taxa = 100;
                }

                // 5. Calcular Rotas (DirectionsService)
                const coordBase = new google.maps.LatLng(BASE_ADDRESS.lat, BASE_ADDRESS.lng);
                
                const [dist1, dist2, dist3] = await Promise.all([
                    getDistance(coordBase, coordOrigem),    // Base -> Origem
                    getDistance(coordOrigem, coordDestino), // Origem -> Destino
                    getDistance(coordDestino, coordBase)    // Destino -> Base
                ]); 

                // 6. Apresentar Resultado
                const distanciaTotalKm = dist1 + dist2 + dist3;
                const valorKm = distanciaTotalKm * 1.7; // R$ 1,70 por km
                const valorTotal = valorKm + taxa;
                
                const detalhesMoto = tipoVeiculo === "15" ? 
                    ` (Cilindrada: ${document.getElementById("cilindrada-moto").value}cc)` : '';
                
                document.getElementById("resultado").innerText =
                    `Detalhes da Rota:\n` +
                    `Base ‚Üí Origem: ${dist1.toFixed(2)} km\n` +
                    `Origem ‚Üí Destino: ${dist2.toFixed(2)} km\n` +
                    `Destino ‚Üí Base: ${dist3.toFixed(2)} km\n\n` +
                    `Dist√¢ncia Total (ida e volta): ${distanciaTotalKm.toFixed(2)} km\n` +
                    `Custo por KM (R$ 1,70/km): R$ ${valorKm.toFixed(2)}\n` +
                    `Taxa Fixa (Ve√≠culo: ${tipoVeiculo === '50' ? 'Carro' : 'Moto'}${detalhesMoto}): R$ ${taxa.toFixed(2)}\n` +
                    `\nüí∞ VALOR TOTAL ESTIMADO: R$ ${valorTotal.toFixed(2)}`;
                
                // Exibe os bot√µes de a√ß√£o
                updateWhatsappButton(origemAddress, destinoAddress, valorTotal); // Usa os endere√ßos tratados acima
                document.getElementById("nova-consulta-container").style.display = 'block';
                
            } catch (error) {
                console.error("Erro no c√°lculo:", error);
                
                let userMessage = error.message;

                if (userMessage.includes("Rota n√£o encontrada")) {
                    userMessage = `N√£o foi poss√≠vel tra√ßar a rota. Verifique a precis√£o dos endere√ßos.`;
                } else {
                    userMessage = `Falha no c√°lculo: ${userMessage}`;
                }

                mostrarMensagemErro(`‚ùå Erro: ${userMessage}`); 
                document.getElementById("resultado").innerText = "‚ùå Erro no c√°lculo. Verifique a mensagem acima.";
                
                // Garante que os bot√µes de a√ß√£o fiquem ocultos em caso de erro
                document.getElementById("whatsapp-container").style.display = 'none';
                document.getElementById("nova-consulta-container").style.display = 'none';
            }
        }
        
        // --- FUN√á√ÉO DE CONFIRMA√á√ÉO DO MAPA ---
        function confirmMapSelection() {
            if (!currentMapMode) return; 

            limparMensagemErro();
            let coordLatField, coordLonField, addressField, inputPrefix;

            if (currentMapMode === 'ORIGIN') {
                coordLatField = document.getElementById('coord-origem-lat');
                coordLonField = document.getElementById('coord-origem-lon');
                addressField = document.getElementById('origem');
                inputPrefix = 'Origem';
                
                // Valida√ß√£o de coordenadas do mapa
                if (coordLatField.value === "" || coordLonField.value === "") {
                    mostrarMensagemErro(`‚ùå Por favor, CLIQUE no mapa para definir o ponto de ${inputPrefix} antes de confirmar.`);
                    return;
                }
                
                // Limpa inputs de Autocomplete ao CONFIRMAR mapa
                document.getElementById("numero-origem-auto").value = "";
                document.getElementById("input-endereco-origem").value = "";
                document.getElementById("base-address-origem").value = ""; 

            } else { // DESTINATION
                coordLatField = document.getElementById('coord-destino-lat');
                coordLonField = document.getElementById('coord-destino-lon');
                addressField = document.getElementById('destino');
                inputPrefix = 'Destino';
                
                 if (coordLatField.value === "" || coordLonField.value === "") {
                    mostrarMensagemErro(`‚ùå Por favor, CLIQUE no mapa para definir o ponto de ${inputPrefix} antes de confirmar.`);
                    return;
                }
                
                // Limpa inputs de Autocomplete ao CONFIRMAR mapa
                document.getElementById("numero-destino-auto").value = "";
                document.getElementById("input-endereco-destino").value = "";
                document.getElementById("base-address-destino").value = "";
            }

            // 1. Ocultar se√ß√£o do mapa
            document.getElementById("map-interaction-section").style.display = 'none';

            // 2. Resetar o modo
            currentMapMode = null;
            
            // 3. Ocultar marcadores 
            if (originMarker) originMarker.setVisible(false);
            if (destinationMarker) destinationMarker.setVisible(false);

            // 4. Feedback visual e atualiza√ß√£o do campo 
            // CORRE√á√ÉO: Limpa o endere√ßo de qualquer status, incluindo (Mapa)
            addressField.value = limparStatusConfirmado(addressField.value);
            addressField.style.fontWeight = 'bold';
        }
        
        // === L√ìGICA DE TOGGLE PARA ORIGEM (2 OP√á√ïES: Auto e Mapa) ===
        
        function toggleOriginInput(choice) {
            limparMensagemErro();
            const autoBlock = document.getElementById("origin-autocomplete-block"); 
            const origemField = document.getElementById("origem");
            const mapSection = document.getElementById("map-interaction-section");
            
            // 1. Limpa o estado e esconde tudo
            mapSection.style.display = 'none';
            autoBlock.style.display = 'none'; 

            // 2. Limpa Coordenadas Salvas, Endere√ßo de Exibi√ß√£o e Feedback
            document.getElementById("coord-origem-lon").value = "";
            document.getElementById("coord-origem-lat").value = "";
            document.getElementById("base-address-origem").value = ""; 
            origemField.style.fontWeight = 'normal';
            origemField.value = "";
            
            // Ocultar marcadores 
            if (originMarker) originMarker.setVisible(false);
            if (destinationMarker) destinationMarker.setVisible(false);
            currentMapMode = null;
            
            // 3. Ativa o bloco e ajusta o placeholder
            if (choice === 'map') {
                // Ativa o modo Mapa
                currentMapMode = 'ORIGIN';
                document.getElementById("origin-map-placeholder").appendChild(mapSection);
                mapSection.style.display = 'block';
                
                origemField.placeholder = "Endere√ßo definido pelo mapa (Aguardando Confirma√ß√£o)";
                
                // Limpa inputs de Autocomplete ao mudar de modo
                document.getElementById("numero-origem-auto").value = "";
                document.getElementById("input-endereco-origem").value = "";
                
                // NOVO: Chama a geolocaliza√ß√£o autom√°tica para centralizar o mapa
                if (map) {
                     google.maps.event.trigger(map, 'resize'); 
                     getAndCenterCurrentLocation('ORIGIN');
                }

            } else if (choice === 'auto') { 
                autoBlock.style.display = 'block';
                origemField.placeholder = "Informe a rua e o n√∫mero nos campos acima";
            }
        }
        
        // === L√ìGICA DE TOGGLE PARA DESTINO (2 OP√á√ïES) ===

        function toggleDestinationInput(choice) {
            limparMensagemErro();
            const autoBlock = document.getElementById("destination-autocomplete-block"); 
            const destinoField = document.getElementById("destino");
            const mapSection = document.getElementById("map-interaction-section");
            
            // 1. Limpa o estado e esconde tudo
            mapSection.style.display = 'none';
            autoBlock.style.display = 'none'; 
            
            // 2. Limpa Coordenadas Salvas e Endere√ßo de Exibi√ß√£o
            document.getElementById("coord-destino-lon").value = "";
            document.getElementById("coord-destino-lat").value = "";
            document.getElementById("base-address-destino").value = ""; // Limpa endere√ßo base
            destinoField.style.fontWeight = 'normal';
            destinoField.value = "";
            
            // Ocultar marcadores
            if (originMarker) originMarker.setVisible(false);
            if (destinationMarker) destinationMarker.setVisible(false);
            currentMapMode = null;

            
            // 3. Ativa o bloco e ajusta o placeholder
            if (choice === 'map') {
                // Ativa o modo Mapa
                currentMapMode = 'DESTINATION';
                
                document.getElementById("destination-map-placeholder").appendChild(mapSection);
                mapSection.style.display = 'block';

                if (map && destinationMarker) {
                    google.maps.event.trigger(map, 'resize'); 
                    
                    const center = destinationMarker.getPosition() || RIO_CENTER;
                    map.setCenter(center);
                    map.setZoom(14); 
                }
                
                document.getElementById("map-status").textContent = `Clique no mapa para definir o local de destino`;
                if (destinationMarker) destinationMarker.setVisible(true);
                
                mapSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                destinoField.placeholder = "Endere√ßo definido pelo mapa (Aguardando Confirma√ß√£o)";
                // Limpa inputs de Autocomplete ao usar mapa
                document.getElementById("numero-destino-auto").value = "";
                document.getElementById("input-endereco-destino").value = "";

            } else if (choice === 'auto') { // MODO AUTOCOMPLETE
                autoBlock.style.display = 'block';
                destinoField.placeholder = "Informe a rua e o n√∫mero nos campos acima";
            }
        }

        async function handleMapClick(event) {
            if (!currentMapMode) return;
            
            limparMensagemErro();
            let marker, addressField, coordLatField, coordLonField, inputPrefix;
            
            const mapStatus = document.getElementById("map-status");
            mapStatus.textContent = "Buscando endere√ßo (Geocoding Reverso)...";
            document.getElementById("btn-confirmar-mapa").disabled = true;


            try {
                const enderecoTexto = await reverseGeocode(event.latLng);
                
                if (currentMapMode === 'ORIGIN') {
                    marker = originMarker;
                    addressField = document.getElementById('origem');
                    coordLatField = document.getElementById('coord-origem-lat');
                    coordLonField = document.getElementById('coord-origem-lon');
                    inputPrefix = 'Origem';
                    
                    // Limpar inputs de Autocomplete ao usar mapa
                    document.getElementById("numero-origem-auto").value = "";
                    document.getElementById("input-endereco-origem").value = "";
                    document.getElementById("base-address-origem").value = "";
                    
                } else { // 'DESTINATION'
                    marker = destinationMarker;
                    addressField = document.getElementById('destino');
                    coordLatField = document.getElementById('coord-destino-lat');
                    coordLonField = document.getElementById('coord-destino-lon');
                    inputPrefix = 'Destino';
                    
                    // Limpar inputs de Autocomplete ao usar mapa
                    document.getElementById("numero-destino-auto").value = "";
                    document.getElementById("input-endereco-destino").value = "";
                    document.getElementById("base-address-destino").value = "";
                }

                // 1. Atualiza o Marcador
                marker.setPosition(event.latLng);
                marker.setVisible(true);
                
                // 2. Atualiza o Endere√ßo de Texto (Adiciona (Mapa) para sinalizar que precisa confirmar)
                addressField.value = `${enderecoTexto} (Mapa)`; 
                addressField.style.fontWeight = 'normal'; // Tira o negrito enquanto n√£o confirma
                
                // 3. Atualiza as Coordenadas Ocultas (Para o c√°lculo)
                coordLatField.value = event.latLng.lat();
                coordLonField.value = event.latLng.lng();
                
                mapStatus.textContent = `${inputPrefix} temporariamente definido. Clique em 'Confirmar Localiza√ß√£o'.`;

            } catch (e) {
                mostrarMensagemErro(`‚ùå Erro ao definir localiza√ß√£o: ${e.message}`);
            } finally {
                 document.getElementById("btn-confirmar-mapa").disabled = false;
            }
        }
        
        // --- SETUP INICIAL ---
        window.onload = function() {
            
            document.getElementById("btn-calcular").addEventListener("click", calcular);
            document.getElementById("btn-nova-consulta").addEventListener("click", resetForm); 
            
            document.getElementById("btn-confirmar-mapa").addEventListener("click", confirmMapSelection);
            
            // Listener para o campo de n√∫mero da Origem (PARA ATUALIZAR O CAMPO VIS√çVEL)
            document.getElementById("numero-origem-auto").addEventListener("input", updateOriginDisplayAddress);
            // Listener para o campo de n√∫mero do Destino (PARA ATUALIZar O CAMPO VIS√çVEL)
            document.getElementById("numero-destino-auto").addEventListener("input", updateDestinationDisplayAddress);

            
            // Listener para o Radio Group (Altern√¢ncia de Origem)
            document.querySelectorAll('input[name="origin-choice"]').forEach(radio => {
                radio.addEventListener('change', (e) => toggleOriginInput(e.target.value));
            });
            
            // Listener para o Radio Group (Altern√¢ncia de Destino)
            document.querySelectorAll('input[name="destination-choice"]').forEach(radio => {
                radio.addEventListener('change', (e) => toggleDestinationInput(e.target.value));
            });
            
            document.getElementById("tipo").addEventListener("change", e => {
                const showMoto = e.target.value === "15";
                document.getElementById("detalhes-moto").style.display = showMoto ? "block" : "none";
                
                if (!showMoto) {
                    document.getElementById("marca-moto").value = "";
                    document.getElementById("modelo-moto").value = "";
                    document.getElementById("cilindrada-moto").value = "";
                }
            });
            
            // Inicializa o estado dos bot√µes de a√ß√£o como ocultos
            document.getElementById("whatsapp-container").style.display = 'none';
            document.getElementById("nova-consulta-container").style.display = 'none';
            document.getElementById("whatsapp-solicitar-btn").setAttribute('disabled', 'true');
            
            // Inje√ß√£o do script do Google Maps com a biblioteca 'places' e 'geometry'
            if (API_KEY_GOOGLE) {
                 const script = document.createElement('script');
                 // A fun√ß√£o initMap √© definida no JS e ser√° chamada quando o script carregar
                 script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY_GOOGLE}&libraries=geometry,places&callback=initMap`;
                 script.onerror = () => {
                     mostrarMensagemErro("‚ùå Falha no carregamento dos servi√ßos de mapa. Tente recarregar a p√°gina."); 
                 };
                 document.head.appendChild(script);
            } else {
                 mostrarMensagemErro("‚ùå Chave de API de mapa n√£o configurada. O c√°lculo n√£o funcionar√°.");
            }
        };
    </script>
</head>
<body>
    <main class="container">
        <!-- BLOCO DE LOGO -->
        <div class="logo-container">
            <!-- Use esta URL como placeholder para o seu logo.png -->
            <img src="logo.png" 
                 alt="Logo GBservice Reboque" 
                 class="logo-img" 
                 onerror="this.onerror=null;this.src='https://placehold.co/200x50/999999/ffffff?text=Logo+Indispon√≠vel';" />
        </div>
        <!-- FIM BLOCO DE LOGO -->
        
        <div id="mensagem-erro" class="mensagem-erro" style="display: none;"></div>
        
        <!-- CAMPOS HIDDEN PARA SALVAR COORDENADAS E ENDERE√áO BASE -->
        <input type="hidden" id="coord-origem-lon" value="" />
        <input type="hidden" id="coord-origem-lat" value="" />
        <input type="hidden" id="base-address-origem" value="" /> <!-- Armazena o objeto Place (JSON) -->
        <input type="hidden" id="coord-destino-lon" value="" />
        <input type="hidden" id="coord-destino-lat" value="" />
        <input type="hidden" id="base-address-destino" value="" /> <!-- Armazena o objeto Place (JSON) -->

        <section class="section endereco-section">
            <h2>Onde o ve√≠culo est√°?</h2>
            
            <div class="input-toggle">
                <!-- <label>Como deseja informar?</label> -->
                <div class="radio-group">
                    <input type="radio" id="choice-origem-auto" name="origin-choice" value="auto" checked>
                    <label for="choice-origem-auto">Digitar endere√ßo</label>
                    
                    <input type="radio" id="choice-origem-map" name="origin-choice" value="map">
                    <label for="choice-origem-map">Selecionar no mapa</label> <!-- AJUSTADO -->
                </div>
            </div>
            
            <!-- BLOCO DE AUTOCOMPLETE (Origem) com N√∫mero Adicionado -->
            <div id="origin-autocomplete-block" class="input-block">
                <div class="form-group">
                    <label for="input-endereco-origem">Informe a Rua/Avenida:</label>
                    <!-- O valor permanecer√° aqui ap√≥s a sele√ß√£o -->
                    <input type="text" id="input-endereco-origem" placeholder="Ex: Av. Brasil" /> 
                    <small style="color: #666; margin-top: 5px;">Comece a digitar para selecionar o endere√ßo</small>
                </div>
                <div class="form-group">
                    <label for="numero-origem-auto">N√∫mero:</label>
                    <input type="number" id="numero-origem-auto" placeholder="N√∫mero do endere√ßo (Obrigat√≥rio)" required />
                    <small style="color: #666; margin-top: 5px;">O endere√ßo completo ser√° preenchido no campo abaixo automaticamente</small>
                </div>
            </div>

            <!-- Placeholder para o mapa de Origem -->
            <div id="origin-map-placeholder"></div>
            
            <!-- CAMPO DE ENDERE√áO RESULTANTE (comum aos m√©todos) -->
            <div class="form-group">
                <!-- <label for="origem">Endere√ßo de Origem (Gerado automaticamente):</label> -->
                <!-- Este campo agora mostra a formata√ß√£o correta e sem o sufixo (CONFIRMADO) -->
                <input disabled type="text" id="origem" placeholder="Informe a rua e o n√∫mero nos campos acima" autocomplete="street-address" />
            </div>
        </section>

        <section class="section destino-section">
            <h2>Para onde deseja levar?</h2>
            
            <div class="input-toggle">
                <!-- <label>Como deseja informar o destino?</label> -->
                <div class="radio-group">
                    <input type="radio" id="choice-dest-auto" name="destination-choice" value="auto" checked>
                    <label for="choice-dest-auto">Digitar endere√ßo</label>
                    
                    <input type="radio" id="choice-dest-map" name="destination-choice" value="map">
                    <label for="choice-dest-map">Selecionar no mapa</label>
                </div>
            </div>
            
            <!-- BLOCO DE AUTOCOMPLETE (Destino) com N√∫mero Adicionado -->
            <div id="destination-autocomplete-block" class="input-block">
                <div class="form-group">
                    <label for="input-endereco-destino">Informe a Rua/Avenida:</label>
                    <input type="text" id="input-endereco-destino" placeholder="Ex: Av. Rio Branco" />
                    <small style="color: #666; margin-top: 5px;">Comece a digitar para selecionar o endere√ßo</small>
                </div>
                <div class="form-group">
                    <label for="numero-destino-auto">N√∫mero:</label>
                    <input type="number" id="numero-destino-auto" placeholder="N√∫mero do endere√ßo (Obrigat√≥rio)" required />
                    <small style="color: #666; margin-top: 5px;">O endere√ßo completo ser√° preenchido no campo abaixo automaticamente</small>
                </div>
            </div>

            <!-- Placeholder para o mapa de Destino -->
            <div id="destination-map-placeholder"></div>
            
            <div class="form-group" style="margin-top: 15px;">
                <!-- <label for="destino">Endere√ßo de destino (Gerado automaticamente):</label> -->
                <!-- Este campo agora mostra a formata√ß√£o correta e sem o sufixo (CONFIRMADO) -->
                <input disabled type="text" id="destino" placeholder="Informe a rua e o n√∫mero nos campos acima" autocomplete="address-line1" />
            </div>
            
            <div class="form-group">
                <label for="tipo">Tipo de Ve√≠culo:</label>
                <select id="tipo" aria-label="Tipo de ve√≠culo">
                    <option value="" disabled selected>Selecione</option>
                    <option value="50">Carro</option>
                    <option value="15">Moto</option>
                </select>
            </div>
            <div id="detalhes-moto" style="display: none;">
                <div class="form-group">
                    <label for="marca-moto">Marca:</label>
                    <input type="text" id="marca-moto" placeholder="Ex.: Honda" />
                </div>
                <div class="form-group">
                    <label for="modelo-moto">Modelo:</label>
                    <input type="text" id="modelo-moto" placeholder="Ex.: CG Titan" />
                </div>
                <div class="form-group">
                    <label for="cilindrada-moto">Cilindrada:</label>
                    <input type="number" id="cilindrada-moto" placeholder="Ex.: 160" />
                </div>
            </div>
        </section>
        
        <!-- SE√á√ÉO DE INTERA√á√ÉO COM O MAPA (Esta se√ß√£o √© movida dinamicamente para o placeholder ativo) -->
        <section id="map-interaction-section" class="section" style="display: none;">
            <div id="map-canvas"></div> <!-- O mapa aparece primeiro -->
            <div class="map-controls">
                 <p id="map-status" class="map-status">Clique no mapa para definir o local</p>
                 <button id="btn-confirmar-mapa" type="button">Confirmar Localiza√ß√£o</button>
            </div>
        </section>
        <!-- FIM SE√á√ÉO DE INTERA√á√ÉO COM O MAPA -->

        <section class="section acao-section">
            <button id="btn-calcular" type="button">Calcular Valor</button>
        </section>

        <section class="section resultado-section" aria-live="polite" aria-atomic="true">
            <div id="resultado">Preencha todos os campos e clique em Calcular Valor</div>
        </section>

        <section class="section whatsapp-section">
            <div id="whatsapp-container" style="display: none;">
                <button id="whatsapp-solicitar-btn" class="whatsapp-button" disabled>Solicitar reboque via WhatsApp</button>
            </div>
            <!-- BOT√ÉO DE NOVA CONSULTA -->
            <div id="nova-consulta-container" style="display: none; margin-top: 15px;">
                <button id="btn-nova-consulta" type="button" style="background-color: #f59e0b;">Nova Consulta</button>
            </div>
        </section>
        <!-- RODAP√â CORRIGIDO PARA SER DISCRETO E CENTRALIZADO -->
        <footer class="footer">
            <p>Desenvolvido por <strong>Natanael Costa</strong></p>
        </footer>
    </main>
</body>
</html>
